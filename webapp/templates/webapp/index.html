<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'styles/style.css' %}" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="{% static 'jquery-3.3.1.min.js' %}" type="text/javascript"></script>
	<script src="{% static 'bootstrap.min.js' %}" type="text/javascript"></script>
</head>
<body>

<nav class="navbar">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="">Risk Hunters</a>
    </div>
    <form class="navbar-form navbar-right">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
  </div>
</nav>

<div class="container">

    <div class="row">

        <div class="col-lg-6">
          <img src="{% static 'images/red-panda.jpg' %}" alt="Red Panda" class="red-panda" style="width: 120%;"/>
        </div>

        <div class="col-lg-6">
            <div class="panel panel-success">

                <h1 class="name">{{name}} <span class="latin-name">{{latin_name}}</span></h1>

                <h4><i class="fa fa-info-circle status-icon" style="font-size:24px;"></i>Status:</h4><span class="current-status">{{ status }}</span>

                </br>
                {% load static %}
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon"/>

                <h4><i class="fa fa-leaf status-icon" style="font-size:24px;"></i>Habitats:</h4>

                <ul>
                    {% load static %}
                    {% for h in habitats %}
                    <li>{{ h }}</li>
                    {% endfor %}
                </ul>

                <h4><i class="fa fa-history status-icon" style="font-size:24px;"></i>History:</h4>

                <p>Year: <span id="demo"></span></p>
                <p>Status: <span id="status">{{ status }}</span></p>

                {% load static %}
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon-history"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon-history"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon-history"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon-history"/>
                <img src="{% static 'images/red-panda-icon.png' %}" alt="Red Panda" class="red-panda-icon-history"/>


                <div class="slidecontainer">
                  <input type="range" min="{{ minimalYear }}" max="2018" value="2018" class="slider" id="myRange">
                </div>

            </div>
        </div>

    </div>

    <br>
    <div class="row">
        <div class="panel panel-success">
            <h4><i class="fa fa-bolt status-icon" style="font-size:24px;"></i>Threats:</h4>
        </div>
    </div>


<p>Threats:</p>
<ul>
    {% load static %}
    {% for t in threats %}
    <li>{{t}}</li>
    {% endfor %}
</ul>

<div class="row">
    <div class="panel panel-success">
        <div id="map" class="mapClass" style="width:800px;height:400px">Forest map</div>
    </div>
</div>

</div>

<script>

function recolor(numberOfColored, className) {
    var x = document.getElementsByClassName(className);
    var y = [];

    for (var j = 0; j < x.length; j++) {
        x[x.length-1-j].classList.remove("disappearing");
        y.push(x[x.length-1-j]);
    }

    for(var i = 0; i < numberOfColored; i++) {
        y[i].classList.add("disappearing");
    }
}

function switch2(x) {
    return {
        "Extinct": 0,
        "Extinct in the wild": 1,
        "Critically endangered": 2,
        'Endangered': 3,
        'Vulnerable': 4,
        "Near threatened": 5
    }[x]
}

recolor(parseInt("{{range}}"), "red-panda-icon-history");
recolor(parseInt("{{range}}"), "red-panda-icon");

var slider = document.getElementById("myRange");
var output = document.getElementById("demo");
output.innerHTML = slider.value;

slider.oninput = function() {
    output.innerHTML = this.value;
    var statuses = {{ statuses | safe }};
    var years = {{ history }};
    var chosen = 0;
    for (var i = 1; i < years.length; i++) {
        if (parseInt(this.value) < years[i]) {
            break;
        }
        chosen = i;
    }
    document.getElementById("status").innerHTML = statuses[years[chosen]];
    recolor(5-switch2(statuses[years[chosen]]), "red-panda-icon-history");
}

function myMap() {
            var mapOptions = {
                center: new google.maps.LatLng(51.5, -0.12),
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.HYBRID
            }
            var map = new google.maps.Map(document.getElementById("map"), mapOptions);
            var map2 = new google.maps.Map(document.getElementById("map2"), mapOptions);
            var map3 = new google.maps.Map(document.getElementById("map3"), mapOptions);
            } 
            </script>
        
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJW6r5vAsQXHXHcu5RT1FbgutrGgmEHXo&callback=myMap"></script> 
    
    <script>
var map;
  
  var josefov = new google.maps.LatLng(49.3119, 16.67029);
  //Define OSM as base layer in addition to the default Google layers
  var osmMapType = new google.maps.ImageMapType({
                  getTileUrl: function (coord, zoom) {
                      return "http://tile.openstreetmap.org/" +
                  zoom + "/" + coord.x + "/" + coord.y + ".png";
                  },
                  tileSize: new google.maps.Size(256, 256),
                  isPng: true,
                  alt: "OpenStreetMap",
                  name: "OSM",
                  maxZoom: 19
              });

 //Define custom WMS tiled layer
 var SHLayer = new google.maps.ImageMapType({
                  getTileUrl: function (coord, zoom) {
                      var proj = map.getProjection();
                      var zfactor = Math.pow(2, zoom);
                      // get Long Lat coordinates
                      var top = proj.fromPointToLatLng(new google.maps.Point(coord.x * 512 / zfactor, coord.y * 512 / zfactor));
                      var bot = proj.fromPointToLatLng(new google.maps.Point((coord.x + 1) * 512 / zfactor, (coord.y + 1) * 512 / zfactor));

                      //create the Bounding box string
                      var bbox =     (top.lng()) + "," +
                                     (bot.lat()) + "," +
                                     (bot.lng()) + "," +
                                     (top.lat());

                      //base WMS URL
                      var url = "https://services.sentinel-hub.com/ogc/wms/ef9855ef-3e2d-462b-96f2-7e08a10dfe9d";
                      url += "?REQUEST=GetMap"; //WMS operation
                      url += "&SERVICE=WMS";    //WMS service
                      url += "&VERSION=1.1.1";  //WMS version  
                      url += "&LAYERS=FORRESTIZATION-PANDA"; //WMS layers
                      url += "&FORMAT=image/jpg" ; //WMS format
                      url += "&SRS=EPSG:4326";     //set WGS84 
                      url += "&BBOX=" + bbox;      // set bounding box
                      url += "&WIDTH=512";         //tile size in google
                      url += "&HEIGHT=512";
                      
                      
                      
                      
                      return url;                 // return URL for the tile

                  },
                  tileSize: new google.maps.Size(512, 512)
              });

                                                

              initialize();
  function initialize() {
      var mapOptions = {
          zoom: 11,
          center: new google.maps.LatLng(27.775239, 85.874997),
          mapTypeId: 'OSM',
          mapTypeControlOptions: {
              mapTypeIds: ['OSM', google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.SATELLITE, google.maps.MapTypeId.HYBRID, google.maps.MapTypeId.TERRAIN],
              style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
          }
      };
      map = new google.maps.Map(document.getElementById("map"), mapOptions);
      map.mapTypes.set('OSM', osmMapType);
      map.setMapTypeId(google.maps.MapTypeId.ROADMAP);
      //add WMS layer
      map.overlayMapTypes.push(SHLayer);
     
  }
</script>

</body>
</html>